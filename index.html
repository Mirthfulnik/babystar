<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚ú® Baby Star - –∑–∞—á–∞—Ç–∏–µ –ø–æ –∑–≤—ë–∑–¥–∞–º</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Nunito:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --rose:    #f4c2d0;
    --blush:   #fde8ef;
    --lavender:#e8d5f0;
    --mint:    #d0ede8;
    --peach:   #fde9d9;
    --sky:     #d5eaf7;
    --cream:   #fff8f2;
    --text:    #5a4155;
    --muted:   #a08aa8;
    --accent:  #c97fa0;
    --accent2: #9b6baf;
    --white:   #ffffff;
    --shadow:  rgba(180,130,160,0.15);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--cream);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ Background blobs ‚îÄ‚îÄ */
  .bg-blobs {
    position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden;
  }
  .blob {
    position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.45;
    animation: floatBlob 18s ease-in-out infinite alternate;
  }
  .blob1 { width: 520px; height: 520px; background: var(--rose);    top: -120px; left: -100px; animation-duration: 20s; }
  .blob2 { width: 400px; height: 400px; background: var(--lavender); top: 30%;  right: -80px; animation-duration: 24s; }
  .blob3 { width: 350px; height: 350px; background: var(--peach);    bottom: 5%; left: 20%;   animation-duration: 17s; }
  .blob4 { width: 280px; height: 280px; background: var(--mint);     bottom: 20%; right: 10%; animation-duration: 22s; }

  @keyframes floatBlob {
    from { transform: translate(0,0) scale(1); }
    to   { transform: translate(30px,40px) scale(1.08); }
  }

  /* ‚îÄ‚îÄ Wrapper ‚îÄ‚îÄ */
  .wrapper {
    position: relative; z-index: 1;
    max-width: 760px; margin: 0 auto;
    padding: 2rem 1.25rem 5rem;
  }

  /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
  header {
    text-align: center;
    padding: 3rem 0 2.5rem;
    animation: fadeDown .8s ease both;
  }
  .logo-icon { font-size: 3.2rem; display: block; margin-bottom: .5rem; animation: pulse 3s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.08)} }
  header h1 {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2rem, 6vw, 3rem);
    font-weight: 600;
    color: var(--accent2);
    line-height: 1.15;
    letter-spacing: .01em;
  }
  header p {
    margin-top: .75rem;
    color: var(--muted);
    font-size: 1rem;
    font-weight: 300;
    max-width: 480px;
    margin-left: auto; margin-right: auto;
  }

  /* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
  .card {
    background: rgba(255,255,255,0.72);
    backdrop-filter: blur(18px);
    border: 1.5px solid rgba(255,255,255,0.85);
    border-radius: 28px;
    padding: 2rem 1.75rem;
    margin-bottom: 1.25rem;
    box-shadow: 0 8px 32px var(--shadow);
    animation: fadeUp .7s ease both;
  }
  .card:nth-child(2) { animation-delay: .1s; }
  .card:nth-child(3) { animation-delay: .2s; }
  .card:nth-child(4) { animation-delay: .3s; }

  @keyframes fadeDown { from{opacity:0;transform:translateY(-22px)} to{opacity:1;transform:none} }
  @keyframes fadeUp   { from{opacity:0;transform:translateY(22px)}  to{opacity:1;transform:none} }

  .card-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.45rem;
    font-weight: 600;
    color: var(--accent2);
    margin-bottom: 1.1rem;
    display: flex; align-items: center; gap: .5rem;
  }

  /* ‚îÄ‚îÄ Zodiac grid ‚îÄ‚îÄ */
  .zodiac-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap: .65rem;
  }
  .zodiac-btn {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: .25rem;
    padding: .75rem .4rem;
    border-radius: 18px;
    border: 2px solid transparent;
    background: rgba(255,255,255,0.6);
    cursor: pointer;
    transition: all .22s ease;
    font-family: 'Nunito', sans-serif;
    font-size: .75rem;
    font-weight: 500;
    color: var(--muted);
    user-select: none;
  }
  .zodiac-btn .z-emoji { font-size: 1.6rem; transition: transform .22s; }
  .zodiac-btn:hover { background: var(--blush); border-color: var(--rose); color: var(--accent); transform: translateY(-2px); }
  .zodiac-btn:hover .z-emoji { transform: scale(1.15); }
  .zodiac-btn.active {
    background: linear-gradient(135deg, var(--rose), var(--lavender));
    border-color: var(--accent);
    color: var(--accent2);
    font-weight: 600;
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(180,100,140,.2);
  }
  .zodiac-btn.active .z-emoji { transform: scale(1.2); }

  /* ‚îÄ‚îÄ Form fields ‚îÄ‚îÄ */
  label {
    display: block;
    font-size: .87rem;
    font-weight: 600;
    color: var(--muted);
    margin-bottom: .45rem;
    letter-spacing: .03em;
  }
  .field-group { margin-bottom: 1.25rem; }
  .field-group:last-child { margin-bottom: 0; }

  input[type="number"], input[type="date"], select {
    width: 100%;
    padding: .75rem 1rem;
    border-radius: 14px;
    border: 1.5px solid rgba(180,140,180,.25);
    background: rgba(255,255,255,0.75);
    font-family: 'Nunito', sans-serif;
    font-size: .95rem;
    color: var(--text);
    outline: none;
    transition: border-color .2s, box-shadow .2s;
  }
  input:focus, select:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(201,127,160,.15);
  }

  .row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  @media (max-width: 480px) { .row-2 { grid-template-columns: 1fr; } }

  .hint {
    font-size: .8rem;
    color: var(--muted);
    margin-top: .4rem;
    line-height: 1.45;
  }

  /* ‚îÄ‚îÄ Slider ‚îÄ‚îÄ */
  .range-wrap { display: flex; align-items: center; gap: .75rem; }
  input[type="range"] {
    flex: 1; -webkit-appearance: none;
    height: 5px; border-radius: 10px;
    background: linear-gradient(to right, var(--accent) 0%, var(--accent) var(--val,50%), rgba(180,140,180,.2) var(--val,50%), rgba(180,140,180,.2) 100%);
    outline: none; border: none; cursor: pointer;
  }
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none; width: 20px; height: 20px;
    border-radius: 50%; background: var(--white);
    border: 2.5px solid var(--accent);
    box-shadow: 0 2px 8px rgba(180,100,140,.25);
    transition: transform .15s;
  }
  input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); }
  .range-val {
    font-weight: 700; color: var(--accent2); font-size: 1rem; min-width: 2.5rem; text-align: center;
  }

  /* ‚îÄ‚îÄ Button ‚îÄ‚îÄ */
  .btn-calc {
    display: block; width: 100%;
    padding: 1rem;
    border-radius: 18px;
    border: none;
    background: linear-gradient(135deg, #e8a0be, #b57bbf);
    color: var(--white);
    font-family: 'Nunito', sans-serif;
    font-size: 1.05rem; font-weight: 700;
    letter-spacing: .04em;
    cursor: pointer;
    box-shadow: 0 8px 24px rgba(180,100,160,.3);
    transition: transform .2s, box-shadow .2s;
    margin-top: .5rem;
  }
  .btn-calc:hover { transform: translateY(-3px); box-shadow: 0 14px 32px rgba(180,100,160,.4); }
  .btn-calc:active { transform: translateY(0); }

  /* ‚îÄ‚îÄ Result card ‚îÄ‚îÄ */
  #result-card {
    display: none;
    animation: fadeUp .6s ease both;
  }
  #result-card.visible { display: block; }

  .result-header {
    display: flex; align-items: center; gap: .75rem;
    margin-bottom: 1.25rem;
  }
  .result-header .big-emoji { font-size: 2.2rem; }
  .result-header h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.6rem; font-weight: 600; color: var(--accent2);
  }

  .period-list { list-style: none; }
  .period-item {
    background: linear-gradient(135deg, rgba(244,194,208,.3), rgba(232,213,240,.3));
    border-radius: 16px;
    padding: 1rem 1.25rem;
    margin-bottom: .75rem;
    border-left: 4px solid var(--accent);
    transition: transform .2s;
  }
  .period-item:hover { transform: translateX(4px); }
  .period-item .pi-head {
    display: flex; align-items: center; gap: .5rem;
    font-weight: 700; color: var(--accent2); font-size: 1rem; margin-bottom: .3rem;
  }
  .period-item .pi-body { font-size: .88rem; color: var(--muted); line-height: 1.6; }
  .period-item .pi-dates { font-size: .95rem; color: var(--text); font-weight: 600; margin-top: .3rem; }

  .ovulation-note {
    background: rgba(208,237,232,.4);
    border-radius: 14px;
    padding: .85rem 1rem;
    font-size: .85rem;
    color: #5a8a84;
    margin-top: 1rem;
    display: flex; align-items: flex-start; gap: .5rem;
  }

  /* ‚îÄ‚îÄ Action buttons ‚îÄ‚îÄ */
  .action-row {
    display: flex; flex-wrap: wrap; gap: .65rem;
    margin-top: 1.25rem;
  }
  .btn-action {
    flex: 1; min-width: 130px;
    padding: .7rem .9rem;
    border-radius: 14px;
    border: 2px solid;
    font-family: 'Nunito', sans-serif;
    font-size: .88rem; font-weight: 700;
    cursor: pointer;
    transition: all .2s;
    display: flex; align-items: center; justify-content: center; gap: .4rem;
  }
  .btn-copy   { background: rgba(244,194,208,.3); border-color: var(--rose);    color: var(--accent); }
  .btn-print  { background: rgba(232,213,240,.3); border-color: var(--lavender);color: var(--accent2);}
  .btn-share  { background: rgba(213,234,247,.3); border-color: var(--sky);     color: #5588aa; }
  .btn-action:hover { transform: translateY(-2px); box-shadow: 0 6px 16px var(--shadow); }
  .btn-action:active { transform: none; }

  .copy-toast {
    display: none; text-align: center; margin-top: .75rem;
    font-size: .85rem; color: var(--accent2); font-weight: 600;
    animation: fadeUp .4s ease;
  }
  .copy-toast.show { display: block; }

  /* ‚îÄ‚îÄ Support block ‚îÄ‚îÄ */
  .support-card {
    text-align: center;
    background: linear-gradient(135deg, rgba(244,194,208,.35), rgba(232,213,240,.35));
    border: 1.5px solid rgba(255,255,255,.9);
  }
  .support-card .support-emoji { font-size: 2rem; display: block; margin-bottom: .5rem; }
  .support-card p { color: var(--muted); font-size: .95rem; margin-bottom: 1rem; }
  .btn-support {
    display: inline-block;
    padding: .7rem 2rem;
    border-radius: 14px;
    border: none;
    background: linear-gradient(135deg, #f4c2d0, #c97fa0);
    color: var(--white);
    font-family: 'Nunito', sans-serif;
    font-size: .95rem; font-weight: 700;
    text-decoration: none;
    box-shadow: 0 6px 20px rgba(180,100,140,.25);
    transition: transform .2s, box-shadow .2s;
  }
  .btn-support:hover { transform: translateY(-3px); box-shadow: 0 12px 28px rgba(180,100,140,.35); }

  /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
  footer {
    text-align: center; color: var(--muted); font-size: .78rem;
    padding: 2rem 0 1rem;
    line-height: 1.7;
  }

  /* ‚îÄ‚îÄ Print styles ‚îÄ‚îÄ */
  @media print {
    .bg-blobs, header .logo-icon, .action-row, .support-card, footer { display: none !important; }
    .card { box-shadow: none; border: 1px solid #eee; break-inside: avoid; }
    body { background: white; }
  }

  /* ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--rose); border-radius: 10px; }

  /* ‚îÄ‚îÄ Tooltip ‚îÄ‚îÄ */
  .label-row {
    display: flex; align-items: center; gap: .4rem;
    margin-bottom: .45rem;
  }
  .label-row label { margin-bottom: 0; }

  .tooltip-wrap {
    position: relative; display: inline-flex; align-items: center;
  }
  .tooltip-btn {
    width: 17px; height: 17px;
    border-radius: 50%;
    border: 1.5px solid var(--muted);
    background: transparent;
    color: var(--muted);
    font-size: .65rem; font-weight: 700;
    line-height: 1;
    cursor: pointer;
    display: inline-flex; align-items: center; justify-content: center;
    transition: all .18s;
    padding: 0; flex-shrink: 0;
    font-family: 'Nunito', sans-serif;
  }
  .tooltip-btn:hover {
    background: var(--rose); border-color: var(--accent); color: var(--accent2);
  }
  .tooltip-box {
    display: none;
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%; transform: translateX(-50%);
    width: 230px;
    background: rgba(255,255,255,0.97);
    border: 1.5px solid var(--rose);
    border-radius: 14px;
    padding: .7rem .85rem;
    font-size: .78rem;
    color: var(--text);
    line-height: 1.55;
    box-shadow: 0 8px 24px rgba(180,120,160,.18);
    z-index: 100;
    pointer-events: none;
  }
  .tooltip-box::after {
    content: '';
    position: absolute;
    top: 100%; left: 50%; transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: var(--rose);
  }
  .tooltip-wrap:hover .tooltip-box,
  .tooltip-wrap.active .tooltip-box { display: block; }

  /* on mobile ‚Äî show below if near top */
  @media (max-width: 540px) {
    .tooltip-box { width: 200px; font-size: .75rem; }
  }
</style>
</head>
<body>

<div class="bg-blobs">
  <div class="blob blob1"></div>
  <div class="blob blob2"></div>
  <div class="blob blob3"></div>
  <div class="blob blob4"></div>
</div>

<div class="wrapper">

  <!-- Header -->
  <header>
    <span class="logo-icon">üå∏‚ú®</span>
    <h1>Baby Star</h1>
    <p>–£–∑–Ω–∞–π, –∫–æ–≥–¥–∞ –∑–∞—á–∞—Ç—å –º–∞–ª—ã—à–∞, —á—Ç–æ–±—ã –æ–Ω —Ä–æ–¥–∏–ª—Å—è –ø–æ–¥ –Ω—É–∂–Ω—ã–º –∑–Ω–∞–∫–æ–º –∑–æ–¥–∏–∞–∫–∞ ‚ú®</p>
  </header>

  <!-- Step 1 ‚Äî Zodiac -->
  <div class="card" id="card-zodiac">
    <div class="card-title">
      ‚≠ê –ñ–µ–ª–∞–µ–º—ã–π –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞
      <span class="tooltip-wrap">
        <button class="tooltip-btn" onclick="toggleTip(this)" type="button">?</button>
        <div class="tooltip-box">–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞–∫–æ–≤ –∑–æ–¥–∏–∞–∫–∞, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —Ä–æ–¥–∏–ª—Å—è –º–∞–ª—ã—à. –ö–∞–∂–¥—ã–π –∑–Ω–∞–∫ ‚Äî —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç —Ä–æ–∂–¥–µ–Ω–∏—è üåü</div>
      </span>
    </div>
    <div class="zodiac-grid" id="zodiac-grid">
      <!-- JS renders buttons -->
    </div>
    <p class="hint" style="margin-top:.9rem">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–Ω–∞–∫–æ–≤ üí´</p>
  </div>

  <!-- Step 2 ‚Äî Cycle -->
  <div class="card" id="card-cycle">
    <div class="card-title">üåô –ú–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω—ã–π —Ü–∏–∫–ª</div>
    <div class="row-2">
      <div class="field-group">
        <div class="label-row">
          <label>–î–ª–∏–Ω–∞ —Ü–∏–∫–ª–∞ (–¥–Ω–µ–π)</label>
          <span class="tooltip-wrap">
            <button class="tooltip-btn" onclick="toggleTip(this)" type="button">?</button>
            <div class="tooltip-box">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –æ–¥–Ω–æ–π –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è —Å–ª–µ–¥—É—é—â–µ–π. –ù–∞–π–¥–∏—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (Flow, Flo, Clue) –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª –∏–ª–∏ ¬´–ê–Ω–∞–ª–∏—Ç–∏–∫–∞¬ª ‚Äî —Ç–∞–º –æ–±—ã—á–Ω–æ –ø–æ–∫–∞–∑–∞–Ω–æ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—è—Ü–µ–≤ üìä</div>
          </span>
        </div>
        <div class="range-wrap">
          <input type="range" id="cycle-len" min="21" max="40" value="28" step="1">
          <span class="range-val" id="cycle-len-val">28</span>
        </div>
        <p class="hint">–°—Ä–µ–¥–Ω–µ–µ: 28 –¥–Ω–µ–π</p>
      </div>
      <div class="field-group">
        <div class="label-row">
          <label>–î–ª–∏–Ω–∞ –ª—é—Ç–µ–∏–Ω–æ–≤–æ–π —Ñ–∞–∑—ã (–¥–Ω–µ–π)</label>
          <span class="tooltip-wrap">
            <button class="tooltip-btn" onclick="toggleTip(this)" type="button">?</button>
            <div class="tooltip-box">–ü–µ—Ä–∏–æ–¥ –æ—Ç –æ–≤—É–ª—è—Ü–∏–∏ –¥–æ –Ω–∞—á–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–π –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö —Ç–∏–ø–∞ Flow Pro –∏–ª–∏ Natural Cycles –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –¥–∞—Ç—É –æ–≤—É–ª—è—Ü–∏–∏ ‚Äî —Ç–æ–≥–¥–∞: –¥–∞—Ç–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –º–µ—Å—è—á–Ω—ã—Ö –º–∏–Ω—É—Å –¥–∞—Ç–∞ –æ–≤—É–ª—è—Ü–∏–∏ = –ª—é—Ç–µ–∏–Ω–æ–≤–∞—è —Ñ–∞–∑–∞. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ 14 –¥–Ω–µ–π (–ø–æ–¥—Ö–æ–¥–∏—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤—É) üåô</div>
          </span>
        </div>
        <div class="range-wrap">
          <input type="range" id="luteal" min="10" max="16" value="14" step="1">
          <span class="range-val" id="luteal-val">14</span>
        </div>
        <p class="hint">–û–±—ã—á–Ω–æ 12‚Äì16 –¥–Ω–µ–π</p>
      </div>
    </div>
    <div class="field-group">
      <div class="label-row">
        <label>üìÖ –ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏</label>
        <span class="tooltip-wrap">
          <button class="tooltip-btn" onclick="toggleTip(this)" type="button">?</button>
          <div class="tooltip-box">–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ—Å—è—á–Ω—ã—Ö ‚Äî —ç—Ç–æ —Ç–æ—á–∫–∞ –æ—Ç—Å—á—ë—Ç–∞ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –æ–≤—É–ª—è—Ü–∏–∏. –í –ª—é–±–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–ª—è —Ü–∏–∫–ª–∞ (Flow, Flo, Clue –∏ –¥—Ä.) —ç—Ç–æ —Å–∞–º–∞—è –ø–æ—Å–ª–µ–¥–Ω—è—è –∫—Ä–∞—Å–Ω–∞—è –æ—Ç–º–µ—Ç–∫–∞ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ üìÖ</div>
        </span>
      </div>
      <input type="date" id="lmp-date">
    </div>
    <div class="field-group" style="margin-bottom:0">
      <div class="label-row">
        <label>ü•ö –û–∫–Ω–æ —Ñ–µ—Ä—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ (¬±–¥–Ω–µ–π –æ—Ç –æ–≤—É–ª—è—Ü–∏–∏)</label>
        <span class="tooltip-wrap">
          <button class="tooltip-btn" onclick="toggleTip(this)" type="button">?</button>
          <div class="tooltip-box">–°–ø–µ—Ä–º–∞—Ç–æ–∑–æ–∏–¥—ã –∂–∏–≤—É—Ç 3‚Äì5 –¥–Ω–µ–π, —è–π—Ü–µ–∫–ª–µ—Ç–∫–∞ ‚Äî –æ–∫–æ–ª–æ 24 —á–∞—Å–æ–≤. –ü–æ—ç—Ç–æ–º—É —Å–µ–∫—Å –∑–∞ 1‚Äì5 –¥–Ω–µ–π –¥–æ –æ–≤—É–ª—è—Ü–∏–∏ –∏ –≤ –¥–µ–Ω—å –æ–≤—É–ª—è—Ü–∏–∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∑–∞—á–∞—Ç–∏—é. –ó–µ–ª—ë–Ω—ã–µ –¥–Ω–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö Flow/Flo ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –≤–∞—à–µ –æ–∫–Ω–æ. –ó–Ω–∞—á–µ–Ω–∏–µ ¬±3 –¥–Ω—è –ø–æ–¥—Ö–æ–¥–∏—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤—É ü•ö</div>
        </span>
      </div>
      <div class="range-wrap">
        <input type="range" id="fertility-window" min="1" max="5" value="3" step="1">
        <span class="range-val" id="fertility-val">3</span>
      </div>
      <p class="hint">–°–ø–µ—Ä–º–∞—Ç–æ–∑–æ–∏–¥—ã –∂–∏–≤—É—Ç –¥–æ 5 –¥–Ω–µ–π, —è–π—Ü–µ–∫–ª–µ—Ç–∫–∞ ‚Äî –¥–æ 24 —á. –û–∫–Ω–æ ¬±3 –¥–Ω—è ‚Äî —Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å üå∏</p>
    </div>
  </div>

  <!-- Step 3 ‚Äî Year -->
  <div class="card" id="card-year">
    <div class="card-title">üóìÔ∏è –ì–æ–¥ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã—Ö —Ä–æ–¥–æ–≤</div>
    <div class="row-2">
      <div class="field-group">
        <div class="label-row">
          <label>–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è –º–∞–ª—ã—à–∞</label>
          <span class="tooltip-wrap">
            <button class="tooltip-btn" onclick="toggleTip(this)" type="button">?</button>
            <div class="tooltip-box">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–¥, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏–µ –º–∞–ª—ã—à–∞. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–∞–º –ø–æ—Å—á–∏—Ç–∞–µ—Ç, –≤ –∫–∞–∫–∏–µ –º–µ—Å—è—Ü—ã –Ω—É–∂–Ω–æ –∑–∞—á–∞—Ç—å, —á—Ç–æ–±—ã —Ä–æ–¥—ã –ø—Ä–∏—à–ª–∏—Å—å –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≥–æ–¥ üóìÔ∏è</div>
          </span>
        </div>
        <select id="birth-year">
        </select>
      </div>
      <div class="field-group">
        <div class="label-row">
          <label>–î–æ–ø—É—Å—Ç–∏–º–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ (–Ω–µ–¥.)</label>
          <span class="tooltip-wrap">
            <button class="tooltip-btn" onclick="toggleTip(this)" type="button">?</button>
            <div class="tooltip-box">–†–æ–¥—ã —Ä–µ–¥–∫–æ –ø—Ä–∏—Ö–æ–¥—è—Ç —Ç–æ—á–Ω–æ –≤ —Å—Ä–æ–∫. –≠—Ç–æ –ø–æ–ª–µ —Ä–∞—Å—à–∏—Ä—è–µ—Ç –æ–∫–Ω–æ: –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∑–Ω–∞—á–µ–Ω–∏–∏ 2 ‚Äî –º–∞–ª—ã—à –º–æ–∂–µ—Ç —Ä–æ–¥–∏—Ç—å—Å—è –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏ —Ä–∞–Ω—å—à–µ –∏–ª–∏ –ø–æ–∑–∂–µ, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–ø–∞—Å—Ç—å –≤ –Ω—É–∂–Ω—ã–π –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞ üåà</div>
          </span>
        </div>
        <div class="range-wrap">
          <input type="range" id="tolerance" min="0" max="4" value="2" step="1">
          <span class="range-val" id="tolerance-val">2</span>
        </div>
        <p class="hint">–ù–µ–¥–µ–ª–∏ —Ä–∞–Ω—å—à–µ/–ø–æ–∑–∂–µ –Ω–æ—Ä–º—ã</p>
      </div>
    </div>

    <button class="btn-calc" id="btn-calc" onclick="calculate()">
      ‚ú® –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–µ –æ–∫–Ω–∞
    </button>
  </div>

  <!-- Result -->
  <div class="card" id="result-card">
    <div class="result-header">
      <span class="big-emoji">üåü</span>
      <h2>–í–∞—à–∏ –æ–∫–Ω–∞ –∑–∞—á–∞—Ç–∏—è</h2>
    </div>
    <ul class="period-list" id="result-list"></ul>
    <div class="ovulation-note" id="ovulation-note"></div>
    <div id="copy-area" style="display:none"></div>
    <div class="action-row">
      <button class="btn-action btn-copy"  onclick="copyResult()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      <button class="btn-action btn-print" onclick="printResult()">üñ®Ô∏è PDF / –ü–µ—á–∞—Ç—å</button>
      <button class="btn-action btn-share" onclick="shareResult()">üíå –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
    <div class="copy-toast" id="copy-toast">‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä!</div>
  </div>

  <!-- Support -->
  <div class="card support-card">
    <span class="support-emoji">‚òï</span>
    <p><strong>–ü–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?</strong><br>–í—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –Ω–∞—Å, –∞ –º—ã –∫—É–ø–∏–º —Å–µ–±–µ –∫–æ—Ñ–µ ‚òïüòä</p>
    <a class="btn-support" href="#" target="_blank" rel="noopener">üíù –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å</a>
  </div>

  <footer>
    üå∏ Baby Star (–ó–≤—ë–∑–¥–Ω–æ–µ –î–∏—Ç—è) ¬∑ –†–∞—Å—á—ë—Ç –Ω–æ—Å–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä<br>
    –î–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É üíó
  </footer>

</div>

<script>
/* ‚îÄ‚îÄ Tooltip toggle (mobile tap support) ‚îÄ‚îÄ */
function toggleTip(btn){
  const wrap = btn.closest('.tooltip-wrap');
  const isActive = wrap.classList.contains('active');
  // close all open tooltips
  document.querySelectorAll('.tooltip-wrap.active').forEach(w => w.classList.remove('active'));
  if(!isActive) wrap.classList.add('active');
}
// close tooltip when clicking outside
document.addEventListener('click', e => {
  if(!e.target.closest('.tooltip-wrap')){
    document.querySelectorAll('.tooltip-wrap.active').forEach(w => w.classList.remove('active'));
  }
});

/* ‚îÄ‚îÄ Zodiac data ‚îÄ‚îÄ */
const ZODIACS = [
  { name:'–û–≤–µ–Ω',      emoji:'‚ôà', symbol:'Aries',       start:[3,21], end:[4,19] },
  { name:'–¢–µ–ª–µ—Ü',     emoji:'‚ôâ', symbol:'Taurus',      start:[4,20], end:[5,20] },
  { name:'–ë–ª–∏–∑–Ω–µ—Ü—ã',  emoji:'‚ôä', symbol:'Gemini',      start:[5,21], end:[6,20] },
  { name:'–†–∞–∫',       emoji:'‚ôã', symbol:'Cancer',      start:[6,21], end:[7,22] },
  { name:'–õ–µ–≤',       emoji:'‚ôå', symbol:'Leo',         start:[7,23], end:[8,22] },
  { name:'–î–µ–≤–∞',      emoji:'‚ôç', symbol:'Virgo',       start:[8,23], end:[9,22] },
  { name:'–í–µ—Å—ã',      emoji:'‚ôé', symbol:'Libra',       start:[9,23], end:[10,22] },
  { name:'–°–∫–æ—Ä–ø–∏–æ–Ω',  emoji:'‚ôè', symbol:'Scorpio',     start:[10,23],end:[11,21] },
  { name:'–°—Ç—Ä–µ–ª–µ—Ü',   emoji:'‚ôê', symbol:'Sagittarius', start:[11,22],end:[12,21] },
  { name:'–ö–æ–∑–µ—Ä–æ–≥',   emoji:'‚ôë', symbol:'Capricorn',   start:[12,22],end:[1,19] },
  { name:'–í–æ–¥–æ–ª–µ–π',   emoji:'‚ôí', symbol:'Aquarius',    start:[1,20], end:[2,18] },
  { name:'–†—ã–±—ã',      emoji:'‚ôì', symbol:'Pisces',      start:[2,19], end:[3,20] },
];

/* ‚îÄ‚îÄ Zodiac grid ‚îÄ‚îÄ */
const grid = document.getElementById('zodiac-grid');
ZODIACS.forEach((z,i)=>{
  const btn = document.createElement('button');
  btn.className = 'zodiac-btn';
  btn.dataset.idx = i;
  btn.innerHTML = `<span class="z-emoji">${z.emoji}</span><span>${z.name}</span>`;
  btn.onclick = () => { btn.classList.toggle('active'); };
  grid.appendChild(btn);
});

/* ‚îÄ‚îÄ Sliders ‚îÄ‚îÄ */
function bindSlider(id, valId){
  const el = document.getElementById(id);
  const vl = document.getElementById(valId);
  const update = ()=>{
    vl.textContent = el.value;
    const pct = ((el.value-el.min)/(el.max-el.min)*100).toFixed(1)+'%';
    el.style.setProperty('--val',pct);
  };
  el.addEventListener('input', update);
  update();
}
bindSlider('cycle-len','cycle-len-val');
bindSlider('luteal','luteal-val');
bindSlider('fertility-window','fertility-val');
bindSlider('tolerance','tolerance-val');

/* ‚îÄ‚îÄ Populate birth year ‚îÄ‚îÄ */
(()=>{
  const sel = document.getElementById('birth-year');
  const curYear = new Date().getFullYear();
  for(let y = 2025; y <= 2050; y++){
    const opt = document.createElement('option');
    opt.value = y;
    opt.textContent = y;
    if(y === Math.max(curYear, 2026)) opt.selected = true;
    sel.appendChild(opt);
  }
})();

/* ‚îÄ‚îÄ Set default LMP date = today ‚îÄ‚îÄ */
const today = new Date();
document.getElementById('lmp-date').value = today.toISOString().split('T')[0];

/* ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ */
const addDays = (d,n)=>{ const r=new Date(d); r.setDate(r.getDate()+n); return r; };
const fmtDate = d => d.toLocaleDateString('ru-RU',{day:'2-digit',month:'long',year:'numeric'});
const fmtShort= d => d.toLocaleDateString('ru-RU',{day:'2-digit',month:'short'});

/* Get zodiac for a date in given year */
function getZodiac(date){
  const m=date.getMonth()+1, d=date.getDate();
  for(const z of ZODIACS){
    const [sm,sd]=z.start, [em,ed]=z.end;
    if(sm>em){ // crosses year boundary (–ö–æ–∑–µ—Ä–æ–≥/–†—ã–±—ã edge)
      if((m===sm&&d>=sd)||(m>sm)||(m<em)||(m===em&&d<=ed)) return z.name;
    } else {
      if((m===sm&&d>=sd)||((m>sm&&m<em))||(m===em&&d<=ed)) return z.name;
    }
  }
  return ZODIACS[0].name;
}

/* Compute ovulation days from LMP cycle info */
function getOvulationDays(lmpDate, cycleLen, lutealDays, monthsAhead){
  const days = [];
  let cur = new Date(lmpDate);
  for(let i=0;i<monthsAhead;i++){
    const ov = addDays(cur, cycleLen - lutealDays);
    days.push(ov);
    cur = addDays(cur, cycleLen);
  }
  return days;
}

/* Gestational age at birth for a conception date (normally ~38 weeks from conception) */
const GESTATION_DAYS = 266; // 38 weeks

/* ‚îÄ‚îÄ Main calculation ‚îÄ‚îÄ */
function calculate(){
  const selected = [...document.querySelectorAll('.zodiac-btn.active')].map(b=>ZODIACS[+b.dataset.idx]);
  if(!selected.length){ alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞ ‚≠ê'); return; }

  const cycleLen      = +document.getElementById('cycle-len').value;
  const lutealDays    = +document.getElementById('luteal').value;
  const lmpVal        = document.getElementById('lmp-date').value;
  const fertWindow    = +document.getElementById('fertility-window').value;
  const birthYear     = +document.getElementById('birth-year').value;
  const tolWeeks      = +document.getElementById('tolerance').value;

  if(!lmpVal){ alert('–£–∫–∞–∂–∏ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏ üìÖ'); return; }

  const lmpDate = new Date(lmpVal);
  const tolDays = tolWeeks * 7;

  /* Generate ovulation days for 24 months ahead */
  const ovDays = getOvulationDays(lmpDate, cycleLen, lutealDays, 30);

  const results = [];

  for(const zodiac of selected){
    /* Zodiac birth window in target year (and adjacent years for edge signs) */
    const [sm,sd]=zodiac.start, [em,ed]=zodiac.end;

    let birthStart, birthEnd;
    if(sm<=em){
      birthStart = new Date(birthYear, sm-1, sd);
      birthEnd   = new Date(birthYear, em-1, ed);
    } else {
      // crosses year boundary
      if(sm>=10){
        birthStart = new Date(birthYear-1, sm-1, sd);
        birthEnd   = new Date(birthYear,   em-1, ed);
      } else {
        birthStart = new Date(birthYear, sm-1, sd);
        birthEnd   = new Date(birthYear+1, em-1, ed);
      }
    }

    /* Expand by tolerance */
    birthStart = addDays(birthStart, -tolDays);
    birthEnd   = addDays(birthEnd,    tolDays);

    /* Back-calculate conception window */
    const concStart = addDays(birthStart, -GESTATION_DAYS);
    const concEnd   = addDays(birthEnd,   -GESTATION_DAYS);

    /* Find ovulation days within conception window */
    const matchingOv = ovDays.filter(ov => ov >= concStart && ov <= concEnd);

    /* Build fertile windows around each ovulation */
    const windows = matchingOv.map(ov=>{
      return {
        fertFrom: addDays(ov, -fertWindow),
        fertTo:   addDays(ov, fertWindow),
        ovDate:   ov,
        predictedBirth: addDays(ov, GESTATION_DAYS),
      };
    });

    /* Also include general conception window even without ovulation match */
    results.push({ zodiac, concStart, concEnd, windows, birthStart: addDays(birthStart,tolDays), birthEnd: addDays(birthEnd,-tolDays) });
  }

  /* Render */
  const list = document.getElementById('result-list');
  list.innerHTML = '';

  let plainText = '‚ú® –û–∫–Ω–∞ –∑–∞—á–∞—Ç–∏—è ‚Äî Baby Star\n\n';

  results.forEach(r=>{
    const { zodiac, concStart, concEnd, windows, birthStart, birthEnd } = r;

    const li = document.createElement('li');
    li.className = 'period-item';

    let html = `<div class="pi-head">${zodiac.emoji} ${zodiac.name}</div>`;

    if(windows.length){
      html += `<div class="pi-body">ü•ö –û–∫–Ω–∞ –∑–∞—á–∞—Ç–∏—è —Å —É—á—ë—Ç–æ–º –æ–≤—É–ª—è—Ü–∏–∏:</div>`;
      windows.forEach(w=>{
        html += `<div class="pi-dates">üìÖ ${fmtDate(w.fertFrom)} ‚Äî ${fmtDate(w.fertTo)}</div>`;
        html += `<div class="pi-body">  –æ–≤—É–ª—è—Ü–∏—è: ${fmtShort(w.ovDate)} ¬∑ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–µ —Ä–æ–¥—ã: ${fmtDate(w.predictedBirth)}</div>`;
        plainText += `${zodiac.emoji} ${zodiac.name}\n–û–∫–Ω–æ: ${fmtDate(w.fertFrom)} ‚Äî ${fmtDate(w.fertTo)}\n–û–≤—É–ª—è—Ü–∏—è: ${fmtShort(w.ovDate)}, —Ä–æ–¥—ã ‚âà ${fmtDate(w.predictedBirth)}\n\n`;
      });
    } else {
      html += `<div class="pi-body">–û–±—â–µ–µ –æ–∫–Ω–æ –∑–∞—á–∞—Ç–∏—è (–±–µ–∑ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –æ–≤—É–ª—è—Ü–∏—é):</div>`;
      html += `<div class="pi-dates">üìÖ ${fmtDate(concStart)} ‚Äî ${fmtDate(concEnd)}</div>`;
      html += `<div class="pi-body">–†–æ–¥—ã –æ–∂–∏–¥–∞—é—Ç—Å—è: ${fmtDate(birthStart)} ‚Äî ${fmtDate(birthEnd)}</div>`;
      plainText += `${zodiac.emoji} ${zodiac.name}\n–û–±—â–µ–µ –æ–∫–Ω–æ: ${fmtDate(concStart)} ‚Äî ${fmtDate(concEnd)}\n–†–æ–¥—ã: ${fmtDate(birthStart)} ‚Äî ${fmtDate(birthEnd)}\n\n`;
    }

    li.innerHTML = html;
    list.appendChild(li);
  });

  /* Ovulation note */
  const ovNote = document.getElementById('ovulation-note');
  ovNote.innerHTML = `üåø <span>–†–∞—Å—á—ë—Ç —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ü–∏–∫–ª <b>${cycleLen} –¥–Ω.</b>, –ª—é—Ç–µ–∏–Ω–æ–≤—É—é —Ñ–∞–∑—É <b>${lutealDays} –¥–Ω.</b>, –æ–∫–Ω–æ —Ñ–µ—Ä—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ <b>¬±${fertWindow} –¥–Ω.</b> –æ—Ç –æ–≤—É–ª—è—Ü–∏–∏. –ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ 266 –¥–Ω–µ–π –æ—Ç –∑–∞—á–∞—Ç–∏—è.</span>`;

  /* Store for copy */
  document.getElementById('copy-area').textContent = plainText;

  /* Show result */
  const rc = document.getElementById('result-card');
  rc.classList.add('visible');
  setTimeout(()=>rc.scrollIntoView({behavior:'smooth',block:'start'}), 100);
}

/* ‚îÄ‚îÄ Copy ‚îÄ‚îÄ */
function copyResult(){
  const txt = document.getElementById('copy-area').textContent;
  navigator.clipboard.writeText(txt).then(()=>{
    const t = document.getElementById('copy-toast');
    t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'), 2500);
  }).catch(()=>{ alert('–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é:\n\n'+txt); });
}

/* ‚îÄ‚îÄ Print ‚îÄ‚îÄ */
function printResult(){ window.print(); }

/* ‚îÄ‚îÄ Share ‚îÄ‚îÄ */
function shareResult(){
  const txt = document.getElementById('copy-area').textContent;
  if(navigator.share){
    navigator.share({ title:'‚ú® –û–∫–Ω–∞ –∑–∞—á–∞—Ç–∏—è ‚Äî Baby Star', text: txt });
  } else {
    const mailto = 'mailto:?subject=‚ú® –ù–∞—à–∏ –æ–∫–Ω–∞ –∑–∞—á–∞—Ç–∏—è&body='+encodeURIComponent(txt);
    window.open(mailto);
  }
}
</script>
</body>
</html>
